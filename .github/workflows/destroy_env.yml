name: Delete Environment

on:
  workflow_call:
    inputs:
      environment_name:
        type: string
        description: "The name of the environment to manage"
        required: true
      environment_destroy:
        type: boolean
        description: "Destroy environment"
        default: false

jobs:
  delete-environment:
    runs-on: ubuntu-latest

    steps:
      - name: Delete Github environment
        if: ${{ inputs.environment_destroy}}
        uses: strumwolf/delete-deployment-environment@v2
        with:
          token: ${{ secrets.ACTIONS_BOT_TOKEN }}
          environment: ${{ inputs.environment_name }}

      - name: Install kubectl
        uses: azure/setup-kubectl@3e0aec4d80787158d308d7b364cb1b702e7feb7f # v4.0.0
        with:
           version: '1.30.5'
      - name: Install helm
        uses: azure/setup-helm@fe7b79cd5ee1e45176fcad797de68ecaf3ca4814 # v4.2.0
        with:
          version: "v3.13.3"